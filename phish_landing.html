<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Company — Sign in</title>
  <style>
    :root{
      --bg:#f7fafc;
      --card:#fff;
      --accent:#0a66c2;
      --danger:#b71818;
      --muted:#666;
      --radius:10px;
      --maxw:420px;
    }
    html,body{height:100%;margin:0}
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background:var(--bg);
      display:flex;align-items:center;justify-content:center;
      padding:28px;color:#111;
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:28px;
      width:100%;
      max-width:var(--maxw);
      box-shadow:0 8px 30px rgba(10,10,20,0.06);
    }
    .brand{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    .logo{
      width:40px;height:40px;border-radius:8px;background:linear-gradient(135deg,#0a66c2,#0a8bd1);
      display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;
    }
    h1{font-size:1.15rem;margin:0}
    .subtitle{color:var(--muted);font-size:0.95rem;margin-top:6px}
    form{margin-top:18px}
    label{display:block;font-size:0.85rem;margin-bottom:6px;color:#333}
    input[type="text"], input[type="password"]{
      width:100%;padding:10px 12px;border:1px solid #e6e9ef;border-radius:8px;font-size:0.95rem;
      box-sizing:border-box;margin-bottom:12px;
    }
    .btn{
      display:inline-block;width:100%;padding:10px 14px;border-radius:8px;background:var(--accent);
      color:#fff;text-decoration:none;text-align:center;font-weight:600;border:none;cursor:pointer;font-size:1rem;
    }
    .secondary{margin-top:10px;text-align:center}
    .secondary a{color:var(--accent);text-decoration:none;font-size:0.9rem}
    .notice{
      margin-top:14px;padding:12px;border-radius:8px;background:#fff6f6;border:1px solid rgba(183,23,23,0.08);
      color:#7a1717;font-size:0.95rem;
    }
    .muted{color:var(--muted);font-size:0.85rem;margin-top:12px}
    footer{margin-top:16px;font-size:0.8rem;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  <div class="card" role="main" aria-labelledby="title">
    <div class="brand">
      <div class="logo" aria-hidden="true">MC</div>
      <div>
        <h1 id="title">Sign in to My Company</h1>
        <div class="subtitle">Secure access to company resources</div>
      </div>
    </div>

    <!-- Visible sign-in style form: NOTE -- we DO NOT transmit the form values to the server -->
    <form id="fake-signin" onsubmit="return false;">
      <label for="user">Email or phone</label>
      <input id="user" name="user" type="text" autocomplete="off" placeholder="name@company.com" />

      <label for="pass">Password</label>
      <input id="pass" name="pass" type="password" autocomplete="off" placeholder="Password" />

      <button id="submitBtn" class="btn" type="button">Sign in</button>
    </form>

    <div class="secondary">
      <a href="#" id="helpLink">Can't access your account?</a>
    </div>

    <!-- This notice clearly labels this as a training page after the attempt -->
    <div id="postNotice" class="notice" style="display:none;">
      <strong>This was a simulated phishing exercise.</strong>
      <div style="margin-top:8px">We did not collect your password. A record that you attempted to sign in has been securely logged for training and follow-up.</div>
      <div style="margin-top:8px"><a id="reportMail" href="mailto:infosec@mycompany.com?subject=Simulated%20Phish%20Report" style="color:var(--accent)">Report to security</a></div>
    </div>

    <div class="muted">If you believe this was real and you revealed sensitive information elsewhere, contact IT immediately.</div>

    <footer>My Company • Security Awareness</footer>
  </div>

  <script>
    // Safe behaviour:
    //  - We never send what the user typed (no credentials).
    //  - We only send the token from the query string so server can map to a user.
    //  - If no token present, we send 'unknown' so you still get a hit for anonymous clicks.
    (function(){
      function getQueryParam(name){
        name = name.replace(/[\\[\\]]/g, '\\\\$&');
        const regex = new RegExp('[?&]'+name+'(=([^&#]*)|&|#|$)');
        const results = regex.exec(window.location.href);
        if(!results) return null;
        if(!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\\+/g,' '));
      }

      const token = getQueryParam('tok') || getQueryParam('token') || 'unknown';

      const submitBtn = document.getElementById('submitBtn');
      const postNotice = document.getElementById('postNotice');

      async function logAttempt(){
        try{
          // send ONLY the token (never include the values of #user or #pass)
          await fetch('/log_attempt', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token: token })
          });
        }catch(e){
          // fail silently — logging shouldn't block user experience
          console.error('Logging failed', e);
        }
      }

      submitBtn.addEventListener('click', async function(e){
        // visual feedback: disable button immediately
        submitBtn.disabled = true;
        submitBtn.textContent = 'Processing...';

        // Log the attempt (no credentials)
        await logAttempt();

        // Show clear training notice (so user knows this was simulation)
        postNotice.style.display = 'block';
        submitBtn.style.display = 'none';

        // Optionally focus the report link for quick action
        document.getElementById('reportMail').focus();
      });

      // Prevent pasting or trying to submit in other ways (defense-in-depth)
      ['user','pass'].forEach(function(id){
        const el = document.getElementById(id);
        el.addEventListener('paste', (ev)=> ev.preventDefault());
        el.add
